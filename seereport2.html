<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≤‡∏ò‡∏¥‡∏ï (‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)</title>
<style>
body {
  font-family: "TH SarabunPSK", sans-serif;
  font-size: 14px;
  margin: 40px;
  color: #000;
}
h3 { text-align: center; margin-bottom: 0; }
p.right { text-align: right; margin-top: 5px; }
table { border-collapse: collapse; width: 100%; margin-bottom: 15px; }
th, td { border: 1px solid #000; padding: 5px 6px; vertical-align: top; }
th { text-align: center; background: #f5f5f5; }
input[type="text"], textarea {
  width: 100%; border: none; border-bottom: 1px dotted #000;
  font-size: 14px; font-family: "TH SarabunPSK", sans-serif;
  outline: none; background: transparent;
}
textarea { resize: none; height: 60px; }
input[type="checkbox"] { transform: scale(1.2); margin-right: 4px; }
.status { text-align: center; font-weight: bold; margin-top: 10px; color: green; }

.btnH {
  display: inline-block;
  background: #c00;
  color: #fff;
  padding: 8px 16px;
  text-decoration: none;
  border-radius: 8px;
  font-weight: bold;
  margin-bottom: 15px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
}
.btnH:hover { background: #a00; }
</style>
<div>
    <a href="home.html" class="btnH">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</a>
</div>
</head>
<body>

<p class="right">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô<br>‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</p>
<h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≤‡∏ò‡∏¥‡∏ï (‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)</h3><br><br>

<div style="margin-bottom:20px;">
  <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô (Job Number): </label>
  <input type="text" id="jobNumberInput" readonly>
</div>

<!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
<table>
  <tr><th>‡πÅ‡∏ú‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡πÄ‡∏ß‡∏•‡∏≤</th></tr>
  <tr><td>‡∏≠‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å Office</td><td><input  type="text" id="startDateInput"></td><td><input  type="text" id="time1"></td></tr>
  <tr><td>‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å</td><td><input  type="text"  id="date2"></td><td><input  type="text" id="time2"></td></tr>
  <tr><td>‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å</td><td><input  type="text" id="date3"></td><td><input  type="text" id="time3"></td></tr>
  <tr><td>‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö Office</td><td><input  type="text" id="endDateInput"></td><td><input  type="text" id="time4"></td></tr>
</table>

<table>
  <tr>
    <td>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</td>
    <td><label><input type="checkbox" id="car_company"> ‡∏£‡∏ñ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label></td>
    <td><label><input type="checkbox" id="car_sales"> ‡∏£‡∏ñ Sales</label></td>
    <td><label><input type="checkbox" id="bus"> ‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ó‡∏≤‡∏á</label></td>
    <td><label><input type="checkbox" id="plane"> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô</label></td>
  </tr>
  <tr>
    <td>Sales ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="sales_no"> ‡πÑ‡∏°‡πà‡πÑ‡∏õ</label></td>
    <td><label><input type="checkbox" id="sales_yes"> ‡πÑ‡∏õ</label></td>
    <td><label><input type="checkbox" id="sales_together"> ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô</label></td>
    <td><label><input type="checkbox" id="sales_separate"> ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡πÑ‡∏õ</label></td>
  </tr>
</table>

<table>
  <tr><td>‡∏°‡∏µ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏≠‡∏∑‡πà‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="company_have"> ‡∏°‡∏µ</label></td>
    <td><label><input type="checkbox" id="company_not_have"> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label></td></tr>
  <tr><td>‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="schedule_have"> ‡∏°‡∏µ</label></td>
    <td><label><input type="checkbox" id="schedule_not_have"> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label></td></tr>
  <tr><td>‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="map_have"> ‡∏°‡∏µ</label></td>
    <td><label><input type="checkbox" id="map_not_have"> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label></td></tr>
  <tr><td>‡∏°‡∏µ‡∏õ‡∏•‡∏±‡πä‡∏Å‡πÑ‡∏ü‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="plug_have"> ‡∏°‡∏µ</label></td>
    <td><label><input type="checkbox" id="plug_not_have"> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label></td></tr>
  <tr><td>‡∏°‡∏µ‡∏õ‡∏±‡πä‡∏°‡∏•‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏°‡πÉ‡∏´‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="air_have"> ‡∏°‡∏µ</label></td>
    <td><label><input type="checkbox" id="air_not_have"> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label></td></tr>
</table>

<table>
  <th colspan="4">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÑ‡∏õ‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≤‡∏ò‡∏¥‡∏ï</th>
  <tr>
    <td><label><input type="checkbox" id="MPUA"> MPU-A</label></td>
    <td><label><input type="checkbox" id="MPUB"> MPU-B</label></td>
    <td><label><input type="checkbox" id="MPUC"> MPU-C</label></td>
    <td><label><input type="checkbox" id="MPUD"> MPU-D</label></td>
  </tr>
</table>

<table>
  <th>- ‡∏ä‡∏∏‡∏î‡πÅ‡∏°‡∏Ñ‡∏Ñ‡∏≤‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</th>
  <td><label><input type="checkbox" id="MC_01"> MC-01</label></td>
  <td><label><input type="checkbox" id="MC_02"> MC-02</label></td>
  <td><label><input type="checkbox" id="MC_03"> MC-03</label></td>
</table>

<table>
  <tr><th>PLC ‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</th><td><input  type="text" id="PLC1"></td><th>‡∏£‡∏∏‡πà‡∏ô</th><td><input  type="text" id="ver"></td></tr>
  <tr><th>‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</th><td><input  type="text" id="BOT"></td><th>‡∏£‡∏∏‡πà‡∏ô</th><td><input  type="text" id="ver2"></td></tr>
  <tr><th>‡πÇ‡∏ï‡πä‡∏∞‡∏ß‡∏≤‡∏á‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå ‡∏Ç‡∏ô‡∏≤‡∏î</th><td colspan="3"><input  type="text" id="tableSize"></td></tr>
  <tr><th>‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà</th></tr>
  <tr><td colspan="4"><input  type="text" id="otherEquip"></td></tr>
</table>

<table>
  <tr><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th></tr>
  <tr><td><textarea id="carry1"></textarea></td><td><input  type="text" id="carryQty1"></td></tr>
  <tr><td><textarea id="carry2"></textarea></td><td><input  type="text" id="carryQty2"></td></tr>
  <tr><td><textarea id="carry3"></textarea></td><td><input  type="text" id="carryQty3"></td></tr>
</table>

<table>
  <tr><th>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏∂‡∏Å‡πÑ‡∏´‡∏ô (‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà)...</th></tr>
  <tr><td><textarea id="roomInfo"></textarea></td></tr>
</table>

<div id="statusMsg" class="status"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCua-GV6L-yz4cQNlSeQwRFNyOvzRQKO9Q",
  authDomain: "events-92057.firebaseapp.com",
  projectId: "events-92057",
  storageBucket: "events-92057.appspot.com",
  messagingSenderId: "33581889849",
  appId: "1:33581889849:web:184cede4ec9f2eb363d0e8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const params = new URLSearchParams(window.location.search);
const jobNumber = params.get("jobNumber");
if (jobNumber) document.getElementById("jobNumberInput").value = jobNumber;

async function loadData() {
  if (!jobNumber) return;

  const q = query(collection(db, "report2"), where("jobNumber", "==", jobNumber));
  const snap = await getDocs(q);
  const statusMsg = document.getElementById("statusMsg");

  if (snap.empty) {
    // üîÅ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ report3.html ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á jobNumber
    statusMsg.textContent = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô Firestore ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ report3...";
    statusMsg.style.color = "red";
    setTimeout(() => {
      window.location.href = `seereport3.html?jobNumber=${encodeURIComponent(jobNumber)}`;
    }, 1500);
    return;
  }

  const data = snap.docs[0].data();

  for (const [key, value] of Object.entries(data)) {
    const el = document.getElementById(key);
    if (!el) continue;
    if (el.type === "checkbox") el.checked = value;
    else el.value = value;
  }

  if (data.carry) {
    data.carry.forEach((item, i) => {
      document.getElementById(`carry${i + 1}`).value = item.item || "";
      document.getElementById(`carryQty${i + 1}`).value = item.qty || "";
    });
  }

  statusMsg.textContent = "‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏à‡∏≤‡∏Å Firestore";
  statusMsg.style.color = "green";

  // üîí ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å input ‡πÄ‡∏õ‡πá‡∏ô read-only
  document.querySelectorAll("input, textarea").forEach(el => {
    el.readOnly = true;
    el.disabled = true;
  });
}

const start = params.get("start") || "";
const end = params.get("end") || "";

// ‚úÖ ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô input (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°)
document.getElementById("jobNumberInput").value = jobNumber;
document.getElementById("startDateInput").value = start;
document.getElementById("endDateInput").value = end;

loadData();
</script>
</body>
</html>
